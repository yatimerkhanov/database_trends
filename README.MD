# Персональный проект в рамках курса Sberbank Reboot DS Тимерханов Юрий 2020г.

## Предметная область и постановка задачи

Я бывший администратор баз данных Oracle с большим опытом и знаниями многих аспектов работы БД.

В арсенал инструментов администраторов БД Oracle (DBA) есть портал Oracle Enterprise Manager (OEM), который позволяет управлять работой многих систем, построенных преимущественно на основе технологий Oracle. Среди прочего функционала OEM собирает и хранит для последующего анализа информацию о конфигурациях компонентов. Информации действительно много и она затрагивает почти все особенности ежесекундной работы БД Oracle. В самом OEM есть инструструменты для анализа и визуализации этих данных, но сам сервис немного перегружен функционалом и может ощутимо медленно работать.

Мне всегда было интересно, как эти данные можно использовать для анализа и прогнозирования работы данных. Но обычно DBA не заходит дальше, чем построить некий график на период времени в прошлом, что мало информативное и обычно выглядит как мельтешение кривых. В последних версиях Oracle сам пытается внедрить интеллектуальный анализ статистики, но я это не смотрел, потому что ушел от администрирования БД.

## Исходные данные, обезличивание и предподготовка

Сейчас у меня есть доступ до БД мониторинга тестовых сред. Я сделал исследование, как это храниться внутри и как можно удобно выгрузить для импорта в pandas.

Выбрал несколько метрик, для примера — это объем БД в Гб(SIZE_GB), объем изменений в Мб(REDOSIZE_MB), средняя нагрузка (DBTIME) по дням. Данные есть за несколько лет, с 2017 года примерно.

Исходные данные имеют значения для имени БД в формате SID_имя_сервера, что может быть расценено как конфиденциальная инфомация, поэтому заменяю на рандомные uuid'ы.

Подробности в [ноутбуке](notebooks/data_preparation.ipynb)

## Визуализация данных

Для наглядности строю графики:

- Линейный график сырых данных
- График с усреднением со скользящим среднем (в днях, задается как параметр). На графике выводиться нижняя и верхняя граница довертительного интервала, выход на которые можно рассмотривать как аномалии.
- График компонентов: тренда, сезонности и шума.

## Предсказание данных

Использую модуль Prophet, который был разработан для прогнозирования большого числа различных бизнес-показателей и строит достаточно хорошие default'ные прогнозы. Кроме того, библиотека дает возможность, изменяя человеко-понятные параметры, улучшать прогноз и не требует от аналитиков глубоких знаний устройства предсказательных моделей.

По сути, это additive regression model, состоящая из следующих компонент:

- Сезонные компоненты  отвечают за моделирование периодических изменений, связанных с недельной и годовой сезонностью.
- Тренд  — это кусочно-линейная или логистическая функция. 
- Шум/аномалии - компонента  отвечает за заданные пользователем аномальные дни, в том числе и нерегулярные, такие как, например, Black Fridays.
- Ошибка  содержит информацию, которая не учтена моделью.

Период для предсказания можно выбирать как отрицательный, чтобы сравнить наглядно на графике как предсказания накладываются на реальные данные и оценить ошибки модели, так и положительный, чтобы получить данные за будущие периоды.

Подробности в [ноутбуке](notebooks/database_trends.ipynb)

### Реализация основного функционала в классе

Чтобы облегчить основной плейбук и сделать единый подход для ноутбука и интерактивного портала весь функционал по загрузке, подготовке, визуализации и построению моделей вынес в классы, исходный код в [файле](src/trends.py)

## Интерактивный дашборд

На основе фрейворка [streamlit](https://www.streamlit.io/) сделал интерактивый дашборд, которые возволяет поиграться с графиками и данным не погружаясь в ноутбуки и осходный код. Приложение упаковано в Docker контейнер, развернуто на vps сервера платформы Digital Ocean.
